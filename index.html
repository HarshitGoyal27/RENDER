<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <div id="second"></div>
    <script type="text/babel">
        function Fun(){
            let [search,setSearch]=React.useState('');
            let [arr,setArr]=React.useState([])
            let [searchLocation,setSearchLocation]=React.useState('');
            let [arrLocation,setArrLocation]=React.useState([])
            let [profiles,setProfile]=React.useState({});//object
            let [skills,setSkills]=React.useState('');//object
            let [location,setLocation]=React.useState('');//object
            let [experience,setEcperience]=React.useState('');//object
            let [Salary,setSalary]=React.useState('');//object
            let [profileArr,setProfileArr]=React.useState([]);
            React.useEffect(()=>{
                async function fetchData1() {
                    try {
                        console.log(search);
                        if(search!==''){
                            let resp = await axios.post('http://localhost:3000/api/searchbar/candidates', { search });
                            // Update the state using setArr
                            setArr(resp.data.data);
                            console.log(resp);
                        }else{
                            setArr([]);
                        }
                        
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                  }
                  fetchData1();
            },[search])
            React.useEffect(()=>{
                async function fetchData2() {
                    try {
                        console.log(searchLocation);
                        if(searchLocation!==''){
                            let resp = await axios.post('http://localhost:3000/api/location/candidates', { searchLocation });
                            // Update the state using setArr
                            setArrLocation(resp.data.data);
                            console.log(resp);
                        }else{
                            setArrLocation([]);
                        }
                        
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                  }
                  fetchData2();
            },[searchLocation])
            React.useEffect(()=>{
                async function fetchData3() {
                    try {
                        console.log(profiles);
                        let resp = await axios.post('http://localhost:3000/api/form/candidates', { profiles });
                        // Update the state using setArr
                        console.log(resp.data.data);//{[]}
                        let candidates=resp.data.data.candidatesData;
                        console.log(candidates);
                        setProfileArr([...candidates]);//async
                        console.log(profileArr);
                        
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                  }                    // Object is empty
                    fetchData3();  
            },[profiles])
            let handleChange1=(e)=>{
                setSearch(e.target.value);
            }
            let handleChange2=(e)=>{
                setSearchLocation(e.target.value);
            }
            let handleSubmit = () => {
                console.log('hello');
                let element=document.querySelectorAll('.one');
                let obj={};
                obj.Skill_Set=element[0].value;
                obj.Salary=element[1].value;
                obj.Current_Location=element[2].value;
                obj.Experience=element[3].value;
                console.log(obj);
                setProfile({...obj})
            };
            return (
                <div>
                    <div style={{display:'flex'}}>
                        <div>
                            <b>SKILLS</b>:&nbsp;<input type="text" id="first" onChange={(e)=>handleChange1(e)}/>
                            {
                                arr.length===0?<div></div>:
                                arr.map((ele,idx)=>(
                                    <div key={`abc#${idx}`}>{ele}</div>
                                ))
                            }
                            <b>LOCATION</b>:&nbsp;<input type='text' id='second' onChange={(e)=>handleChange2(e)}/>
                            {
                                arrLocation.length===0?<div></div>:
                                arrLocation.map((ele,idx)=>(
                                    <div key={`abcdef#${idx}`}>{ele}</div>
                                ))
                            }
                       </div>
                        <table>
                            <thead>
                                <tr>
                                    <th>Skills</th>
                                    <th><input type='text' className='one'/></th>
                                </tr>
                            </thead>
                            <tbody>  
                                <tr>
                                    <th>Annual Salary</th>
                                    <th><input type='text' className='one'/></th>
                                </tr>  
                                <tr>
                                    <th>Current Location</th>
                                    <th><input type='text' className='one'/></th>
                                </tr>  
                                <tr>
                                    <th>Years of Experience</th>
                                    <th><input type='text' className='one'/></th>
                                </tr>
                            </tbody>                                     
                        </table>
                        <button onClick={handleSubmit}>Submit</button>
                    </div>
                    {
                        profileArr.length===0?<div></div>:
                        profileArr.map((ele,idx)=>(
                            <div key={idx} style={{height:'20vw',width:'50vw',marginTop:'50px',border:'2px solid black'}}>
                                <div>Name:{ele.Name}</div>
                                <div>Current Role:{ele.CurrentRole}</div>
                                <div>Previous Role:{ele.PreviousRole}</div>
                                <div>Current Location:{ele.CurrentLocation}</div>
                                <div>Preferred Location:{ele.PrefferedLocation}</div>
                                <div>Skills:{ele.Skills}</div>
                                <div>Salary:{ele.Salary}</div>
                            </div>
                        ))
                    }
                </div>
            )
        }
        ReactDOM.render(<Fun/>,document.getElementById('second'))
    </script>
</body>
</html>